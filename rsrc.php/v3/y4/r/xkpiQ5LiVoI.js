if (self.CavalryLogger) { CavalryLogger.start_js(["wE\/xn"]); }

__d("XVideoInCommentUploadController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/video\/in_comment_upload\/",{});}),null);
__d('UFIUploader',['ActorURI','Arbiter','AsyncRequest','ChannelConstants','FileInput','FileInputUploader','Focus','SubscriptionsHandler','VideoContainerType','VideoUploadConfig','VideoUploader','VideoUploadFile','VideoUploadProgressBar','XVideoInCommentUploadController'],(function a(b,c,d,e,f,g){'use strict';var h='/ajax/ufi/upload/',i='video_encode';function j(k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){this.$UFIUploader1=new (c('FileInput'))(k,l,m);this.$UFIUploader6=n;this.$UFIUploader7=o;this.$UFIUploader8=p;this.$UFIUploader9=q;this.$UFIUploader11=t;this.$UFIUploader10=s;this.$UFIUploader5=v;this.$UFIUploader12=w;this.$UFIUploader13=x;this.$UFIUploader14=y;this.$UFIUploader3=new (c('SubscriptionsHandler'))();this.$UFIUploader3.addSubscriptions(c('Arbiter').subscribe(this.getChannelType(),r||function(){}),this.$UFIUploader1.subscribe('change',function(event){this.$UFIUploader12();if(!this.$UFIUploader1.getValue())return;var z=c('VideoUploadFile').getExtensionFromFileInput(this.$UFIUploader1.getInput());if(c('VideoUploadConfig').videoExtensions[z]){this.doVideoUpload();}else this.doPhotoUpload();}.bind(this)),c('Arbiter').subscribe('video_upload_cancel',function(){if(this.$UFIUploader4)this.$UFIUploader4.abandon();}.bind(this)));c('Focus').setWithoutOutline(l);u(this.$UFIUploader1,this.$UFIUploader2);}j.prototype.destroy=function(){this.$UFIUploader1.destroy();this.$UFIUploader3.release();};j.prototype.doPhotoUpload=function(){this.initPhotoUploader();this.$UFIUploader7();this.$UFIUploader2.setData(this.$UFIUploader6()).setInput(this.$UFIUploader1.getInput()).send();};j.prototype.doVideoUpload=function(){var k=c('XVideoInCommentUploadController').getURIBuilder().getURI();this.$UFIUploader8();k=c('ActorURI').create(k,this.$UFIUploader5);new (c('AsyncRequest'))(k).setHandler(function(l){this.initVideoUploader(l);this.$UFIUploader4.upload(c('VideoUploadFile').fromFileInput(this.$UFIUploader1.input));}.bind(this)).send();};j.prototype.initPhotoUploader=function(){this.$UFIUploader2=new (c('FileInputUploader'))().setAllowCrossPageTransition(true).setURI(h);this.$UFIUploader3.addSubscriptions(this.$UFIUploader2.subscribe('success',function(k,l){this.$UFIUploader13();this.$UFIUploader1.clear();this.$UFIUploader9(l.response);}.bind(this)),this.$UFIUploader2.subscribe('failure',function(k,l){this.$UFIUploader14();this.$UFIUploader1.clear();this.$UFIUploader9(l.response);}.bind(this)));};j.prototype.initVideoUploader=function(k){var l=k.payload.video_uploader[0];this.$UFIUploader4=new (c('VideoUploader'))(l);this.$UFIUploader3.addSubscriptions(this.$UFIUploader4.subscribe('upload-progressed',this.videoUploadUpdate.bind(this)),this.$UFIUploader4.subscribe('upload-finished',this.videoUploadFinished.bind(this)),this.$UFIUploader4.subscribe('upload-failed',this.videoUploadFailed.bind(this)),this.$UFIUploader4.subscribe('post-finished',this.videoPostFinished.bind(this)));};j.prototype.getChannelType=function(){return c('ChannelConstants').getArbiterType(i);};j.prototype.videoUploadUpdate=function(event,k){var l=c('VideoUploadProgressBar').computeProgress(k.start_offset,k.sent_bytes,k.file_size,0,0);l=Math.round(l);this.$UFIUploader10(l);};j.prototype.videoUploadFailed=function(event,k){this.$UFIUploader14();};j.prototype.videoUploadFinished=function(event,k){k.video_container=c('VideoContainerType').LEGACY;this.$UFIUploader4.post(k);this.$UFIUploader13();};j.prototype.videoPostFinished=function(event,k){this.$UFIUploader11(k);};f.exports=j;}),null);