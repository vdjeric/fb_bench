if (self.CavalryLogger) { CavalryLogger.start_js(["E3C32"]); }

__d('SphericalProjectionUtils',['invariant','degToRad','radToDeg','GLMatrix'],(function a(b,c,d,e,f,g,h){var i=c('GLMatrix').vec3,j=c('GLMatrix').mat4,k=15,l=.2,m={convert3dTo2dNormalized:function n(o,p,q,r,s,t,u){var v=c('degToRad')(o),w=c('degToRad')(p),x=c('degToRad')(q),y=c('degToRad')(r),z=c('degToRad')(s),aa=j.create();j.perspective(aa,z,t/u,.1,100);var ba=j.create();j.rotateX(ba,ba,w);j.rotateY(ba,ba,v);j.invert(ba,ba);var ca=j.create();j.rotateX(ca,ca,y);j.rotateY(ca,ca,x);j.multiply(ca,ca,ba);j.multiply(ca,aa,ca);var da=i.fromValues(0,0,-1);i.transformMat4(da,da,ca);var ea=.5+da[0]/2,fa=.5+da[1]/2;return {x:ea,y:fa,isNegativeTwin:da[2]>1};},convert3dTo2dScaled:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dNormalized.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;return {x:w*t,y:x*u,isNegativeTwin:y};},convert3dTo2dScaledUnique:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dNormalized.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;if(y){w=x=-1;}else{w*=t;x*=u;}return {x:w,y:x};},convert3dTo2dOnScreen:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dScaled.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;if(y){w=-w;x=p>0?-u:u;}w=Math.max(0,Math.min(t,w));x=Math.max(0,Math.min(u,x));return {x:w,y:x};},convert2dTo3dNormalized:function n(o,p,q,r,s,t,u){o<=1&&o>=-1||h(0);p<=1&&p>=-1||h(0);var v=c('degToRad')(q),w=c('degToRad')(r),x=c('degToRad')(s),y=j.create();j.perspective(y,x,t/u,.1,100);var z=-o/y[0],aa=-p/y[5],ba=v,ca=w,da=Math.atan(Math.tan(x/2)*y[5]/y[0]),ea=ba+(z<0?da:-da),fa=ca+(aa>0?x/2:-x/2),ga=void 0,ha=void 0,ia=void 0,ja=void 0,ka=void 0;ja=ka=ga=0;while(ga<k&&!(Math.abs(c('radToDeg')(ea-ba))<l&&Math.abs(c('radToDeg')(fa-ca))<l)){ga++;ha=(ba+ea)/2;ia=(ca+fa)/2;var la=m._getRelativePositionWithoutProjection(v,w,ha,ia),ma=la.x,na=la.y;if((aa-ka)*(aa-na)<=0){fa=ia;}else{ca=ia;ka=na;}if((z-ja)*(z-ma)<=0){ea=ha;}else{ba=ha;ja=ma;}}var oa=void 0,pa=void 0;if(ga<k){oa=Math.ceil(c('radToDeg')(ba));pa=Math.ceil(c('radToDeg')(ca));}else{oa=q;pa=r;}return {yaw:oa,pitch:pa};},convert2dTo3dScaled:function n(o,p,q,r,s,t,u){var v=t/2,w=u/2;return m.convert2dTo3dNormalized((o-v)*(2/t),(p-w)*(2/u),q,r,s,t,u);},_getRelativePositionWithoutProjection:function n(o,p,q,r){var s=(p-r)/2,t=(p+r)/2,u=Math.cos((o-q)/2),v=Math.sin((o-q)/2),w=Math.cos(s)*u,x=Math.sin(s)*u,y=Math.cos(t)*v,z=Math.sin(t)*v,aa=2*x*z+2*w*y,ba=2*y*z-2*w*x,ca=1-2*x*x-2*y*y;return {x:aa/ca,y:ba/ca};}};f.exports=m;}),null);