if (self.CavalryLogger) { CavalryLogger.start_js(["62od2"]); }

__d("PhotoProjection",[],(function a(b,c,d,e,f,g){f.exports={EQUIRECTANGULAR:"equirectangular",CUBESTRIP:"cubestrip",CYLINDRICAL:"cylindrical",TILED_CUBEMAP:"tiled_cubemap"};}),null);
__d('SphericalMediaCoreActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';var h={turnOn:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').TURN_ON};},turnOff:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').TURN_OFF};},enableSpherical:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').ENABLE_SPHERICAL};},disableSpherical:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').DISABLE_SPHERICAL};},requestPhoto:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').REQUEST_PHOTO};},requestPhotoFailed:function i(j,k){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').REQUEST_PHOTO_FAILED,data:{id:j,response:k}};},receivePhoto:function i(j,k){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').RECEIVE_PHOTO,data:k};}};f.exports=h;}),null);
__d('SphericalMediaViewActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';f.exports={updateView:function h(i){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEW,data:i};},updateViewport:function h(i,j){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEWPORT,data:{yaw:i,pitch:j}};},updateFOV:function h(i){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_FOV,data:{fov:i}};},updateViewportAndFOV:function h(i,j,k){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEWPORT_AND_FOV,data:{yaw:i,pitch:j,fov:k}};},startAnimating:function h(){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').START_ANIMATING};},stopAnimating:function h(){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').STOP_ANIMATING};}};}),null);
__d('SphericalMediaRenderer.react',['cx','DOM','Image.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(l){j.constructor.call(this,l);this.$SphericalMediaRenderer2=false;if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var m in this.constructor.__subClassMethods)if(typeof this[m]!=='function')throw new Error('Must implement "'+m+'"');}k.prototype.componentWillReceiveProps=function(l){if(!l.isActive&&this.sphericalRenderer){this.__destroy();return;}};k.prototype.shouldComponentUpdate=function(l){return this.shouldRender;};k.prototype.componentDidMount=function(){this.$SphericalMediaRenderer3();};k.prototype.componentWillUnmount=function(){this.__destroy();};k.prototype.__destroy=function(){this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;};k.prototype.$SphericalMediaRenderer3=function(){if(this.$SphericalMediaRenderer2||!this.__isReadyToSetup()||!this.$SphericalMediaRenderer1)return;var l=this.__getCanvas();this.__getRenderer(l).done(function(m){m.updateViewportDimensions(this.props.width,this.props.height);m.addListener('renderingError',function(n,o){return this.__onWebGlRenderFailed(n,o);}.bind(this));m.addListener('renderingContextLost',function(){return this.__onWebGlContextLost();}.bind(this));c('DOM').setContent(this.$SphericalMediaRenderer1,l);this.sphericalRenderer=m;m.renderErrorCheck();this.__onSetupDone(m);}.bind(this),function(m){this.$SphericalMediaRenderer2=true;this.__onWebGlInitFailed(m);return;}.bind(this));};k.prototype.draw=function(l){if(!this.sphericalRenderer)this.$SphericalMediaRenderer3();var m=this.sphericalRenderer;if(!m)return;try{m.render(l);this.__afterDraw(m);}catch(n){this.__onWebGlRenderFailed(n,l);return;}};k.prototype.componentDidUpdate=function(){if(!this.props.isActive)return;var l=this.sphericalRenderer;if(!l){this.$SphericalMediaRenderer3();}else{l.updateViewportDimensions(this.props.width,this.props.height);this.draw(this.__getViewData());}};k.prototype.render=function(){var l=void 0;if(this.props.thumbnail)l=c('React').createElement(c('Image.react'),{className:this.props.isActive&&this.sphericalRenderer?"hidden_elem":'',src:this.props.thumbnail,width:this.props.width,height:this.props.height});return (c('React').createElement('div',null,c('React').createElement('div',{className:!this.props.isActive||!this.sphericalRenderer?"hidden_elem":'',ref:function(m){return this.$SphericalMediaRenderer1=m;}.bind(this)}),l));};f.exports=k;}),null);
__d('SphericalProjectionUtils',['invariant','degToRad','radToDeg','GLMatrix'],(function a(b,c,d,e,f,g,h){var i=c('GLMatrix').vec3,j=c('GLMatrix').mat4,k=15,l=.2,m={convert3dTo2dNormalized:function n(o,p,q,r,s,t,u){var v=c('degToRad')(o),w=c('degToRad')(p),x=c('degToRad')(q),y=c('degToRad')(r),z=c('degToRad')(s),aa=j.create();j.perspective(aa,z,t/u,.1,100);var ba=j.create();j.rotateX(ba,ba,w);j.rotateY(ba,ba,v);j.invert(ba,ba);var ca=j.create();j.rotateX(ca,ca,y);j.rotateY(ca,ca,x);j.multiply(ca,ca,ba);j.multiply(ca,aa,ca);var da=i.fromValues(0,0,-1);i.transformMat4(da,da,ca);var ea=.5+da[0]/2,fa=.5+da[1]/2;return {x:ea,y:fa,isNegativeTwin:da[2]>1};},convert3dTo2dScaled:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dNormalized.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;return {x:w*t,y:x*u,isNegativeTwin:y};},convert3dTo2dScaledUnique:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dNormalized.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;if(y){w=x=-1;}else{w*=t;x*=u;}return {x:w,y:x};},convert3dTo2dOnScreen:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dScaled.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;if(y){w=-w;x=p>0?-u:u;}w=Math.max(0,Math.min(t,w));x=Math.max(0,Math.min(u,x));return {x:w,y:x};},convert2dTo3dNormalized:function n(o,p,q,r,s,t,u){o<=1&&o>=-1||h(0);p<=1&&p>=-1||h(0);var v=c('degToRad')(q),w=c('degToRad')(r),x=c('degToRad')(s),y=j.create();j.perspective(y,x,t/u,.1,100);var z=-o/y[0],aa=-p/y[5],ba=v,ca=w,da=Math.atan(Math.tan(x/2)*y[5]/y[0]),ea=ba+(z<0?da:-da),fa=ca+(aa>0?x/2:-x/2),ga=void 0,ha=void 0,ia=void 0,ja=void 0,ka=void 0;ja=ka=ga=0;while(ga<k&&!(Math.abs(c('radToDeg')(ea-ba))<l&&Math.abs(c('radToDeg')(fa-ca))<l)){ga++;ha=(ba+ea)/2;ia=(ca+fa)/2;var la=m._getRelativePositionWithoutProjection(v,w,ha,ia),ma=la.x,na=la.y;if((aa-ka)*(aa-na)<=0){fa=ia;}else{ca=ia;ka=na;}if((z-ja)*(z-ma)<=0){ea=ha;}else{ba=ha;ja=ma;}}var oa=void 0,pa=void 0;if(ga<k){oa=Math.ceil(c('radToDeg')(ba));pa=Math.ceil(c('radToDeg')(ca));}else{oa=q;pa=r;}return {yaw:oa,pitch:pa};},convert2dTo3dScaled:function n(o,p,q,r,s,t,u){var v=t/2,w=u/2;return m.convert2dTo3dNormalized((o-v)*(2/t),(p-w)*(2/u),q,r,s,t,u);},_getRelativePositionWithoutProjection:function n(o,p,q,r){var s=(p-r)/2,t=(p+r)/2,u=Math.cos((o-q)/2),v=Math.sin((o-q)/2),w=Math.cos(s)*u,x=Math.sin(s)*u,y=Math.cos(t)*v,z=Math.sin(t)*v,aa=2*x*z+2*w*y,ba=2*y*z-2*w*x,ca=1-2*x*x-2*y*y;return {x:aa/ca,y:ba/ca};}};f.exports=m;}),null);
__d('SphericalMediaTaggingUtils',['SphericalProjectionUtils'],(function a(b,c,d,e,f,g){'use strict';var h={getSpatialTagArea:function i(j,k,l){var m=l.h/k.fov,n={w:Math.abs(j.width_degree)*m,h:Math.abs(j.height_degree)*m},o=c('SphericalProjectionUtils').convert3dTo2dScaledUnique(j.center.yaw,j.center.pitch,k.yaw,k.pitch,k.fov,l.w,l.h);return {topLeft:{x:o.x-n.w/2,y:o.y-n.h/2},bottomRight:{x:o.x+n.w/2,y:o.y+n.h/2}};},isPointInTagArea:function i(j,k,l,m){var n=this.getSpatialTagArea(k,l,m);return !(n.topLeft.x>j.x||n.bottomRight.x<j.x||n.topLeft.y>j.y||n.bottomRight.y<j.y);}};f.exports=h;}),null);
__d('SphericalMediaController.react',['cx','FullScreen','performanceNow','React','SphericalMediaTaggingUtils','SphericalViewportControl','ReactRedux','SphericalMediaBaseActions','SphericalMediaViewActions','SphericalMediaConstants'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('ReactRedux').connect,l=c('SphericalMediaBaseActions').dragStart,m=c('SphericalMediaBaseActions').gyroStart,n=c('SphericalMediaBaseActions').mouseEnter,o=c('SphericalMediaBaseActions').significantMove,p=c('SphericalMediaBaseActions').updateBase,q=c('SphericalMediaBaseActions').viewportClicked,r=c('SphericalMediaBaseActions').zoomStart,s=c('SphericalMediaViewActions').stopAnimating,t=c('SphericalMediaViewActions').updateViewportAndFOV,u=c('SphericalMediaViewActions').updateFOV,v=c('SphericalMediaConstants').GYRO_SLIP_FACTOR,w=c('SphericalMediaConstants').LOGGER_SIGNIFICANT_MOVEMENT_DEGREE,x=c('SphericalMediaConstants').LOGGER_SIGNIFICANT_MOVEMENT_MS,y=c('SphericalMediaConstants').RB_FRICTION,z=c('SphericalMediaConstants').RB_SPRING_FACTOR,aa=c('SphericalMediaConstants').RB_MAX_SPRING_DEGREE,ba=c('SphericalMediaConstants').RB_MAX_STRETCH_X_DEGREE,ca=c('SphericalMediaConstants').RB_MAX_STRETCH_Y_DEGREE,da=c('SphericalMediaConstants').TILED_CUBE_TILE_CONTENT_SIZE;i=babelHelpers.inherits(ea,c('React').Component);j=i&&i.prototype;function ea(){var ga,ha;for(var ia=arguments.length,ja=Array(ia),ka=0;ka<ia;ka++)ja[ka]=arguments[ka];return ha=(ga=j.constructor).call.apply(ga,[this].concat(ja)),this.$SphericalMediaController1=0,this.$SphericalMediaController4=false,this.$SphericalMediaController10=function(){var la=this.$SphericalMediaController3;if(la&&!la.isUpdating()){var ma=this.props.viewStore.getState(),na=ma.view,oa=la.getOrientation(),pa=la.getVerticalFieldOfView(),qa=na.fov!==pa||na.pitch!==oa.y||na.yaw!==oa.x;if(qa){la.updateViewport(na.yaw,na.pitch,na.fov);this.$SphericalMediaController2=babelHelpers['extends']({},na);}}}.bind(this),ha;}ea.prototype.componentWillReceiveProps=function(ga){if(ga.isActive!==this.props.isActive&&!ga.isActive)this.$SphericalMediaController6();if(ga.isActive){if(ga.width!==this.props.width||ga.height!==this.props.height)this.$SphericalMediaController7(ga.width,ga.height);if(this.$SphericalMediaController8(ga)!==null&&ga.isFullScreen!==this.props.isFullScreen)this.$SphericalMediaController9(ga);}};ea.prototype.shouldComponentUpdate=function(ga){var ha=ga.isActive&&!this.$SphericalMediaController3;return ha;};ea.prototype.componentDidMount=function(){this.props.viewStore.subscribe(this.$SphericalMediaController10);this.props.isActive&&this.$SphericalMediaController11();};ea.prototype.componentWillUnmount=function(){this.$SphericalMediaController6();};ea.prototype.$SphericalMediaController7=function(ga,ha,ia){var ja=this.$SphericalMediaController3;if(ja){ja.updateViewportClientSize({width:ga,height:ha});if(this.props.maxTileLevel>0){var ka=Math.pow(2,this.props.maxTileLevel),la=da*ka/90,ma=ha/la/3;ja.updateMinVFOV(ma);}var na=this.props.viewStore.getState(),oa=na.view;ja.setFieldOfView(oa.fov);var pa=ja.getVerticalFieldOfView();if(pa!==oa.fov)this.props.viewStore.dispatch(u(pa));}};ea.prototype.$SphericalMediaController12=function(ga){if(!this.$SphericalMediaController5)return null;var ha=this.$SphericalMediaController5.getBoundingClientRect();return {x:ga.clientX-ha.left,y:ga.clientY-ha.top};};ea.prototype.$SphericalMediaController13=function(ga){var ha=this.$SphericalMediaController12(ga);if(!ha)return null;var ia=this.props.tags,ja=this.props.viewStore.getState(),ka=ja.view,la=null;ia.forEach(function(ma){if(c('SphericalMediaTaggingUtils').isPointInTagArea(ha,ma,ka,{w:this.props.width,h:this.props.height}))la=ma;}.bind(this));return la;};ea.prototype.$SphericalMediaController14=function(ga){};ea.prototype.$SphericalMediaController9=function(ga){if(this.$SphericalMediaController3){this.$SphericalMediaController3.reconfigure(this.$SphericalMediaController15(ga));ga.viewStore.dispatch(t(ga.initialYaw,ga.initialPitch,ga.initialFov));}};ea.prototype.$SphericalMediaController11=function(){var ga=void 0;if(!this.$SphericalMediaController5)return;ga=this.$SphericalMediaController5;var ha=this.props.dispatch,ia=this.props.viewStore.dispatch,ja=this.$SphericalMediaController15(this.props),ka=new (c('SphericalViewportControl'))(ga,ja,this.$SphericalMediaController16());this.$SphericalMediaController2={fov:ja.fieldOfView,pitch:ja.initialPitch,yaw:ja.initialHeading};ka.addListener('updateViewportBegin',function(){return ia(s());});ka.addListener('updateViewportMoveStart',function(la){return la?ha(m()):ha(l());});ka.addListener('DOM/click',function(la){var ma=this.$SphericalMediaController13(la);if(ma)this.$SphericalMediaController14(ma);ha(q());}.bind(this));ka.addListener('updateViewportEnd',function(la,ma){ha(p({isPanning:false}));this.$SphericalMediaController17();}.bind(this));ka.addListener('viewportChange',function(la,ma,na){ia(t(la,ma,na));});ka.addListener('zoomStart',function(){return ha(r());});ka.addListener('mouseEnter',function(){return ha(n());});this.$SphericalMediaController3=ka;this.$SphericalMediaController7(this.props.width,this.props.height);};ea.prototype.componentDidUpdate=function(){if(this.props.isActive&&!this.$SphericalMediaController3)this.$SphericalMediaController11();};ea.prototype.render=function(){return (c('React').createElement('div',{ref:function(ga){return this.$SphericalMediaController5=ga;}.bind(this),className:"_5nxw _25i_",tabIndex:0,'aria-label':this.props.caption}));};ea.prototype.$SphericalMediaController6=function(){this.$SphericalMediaController3&&this.$SphericalMediaController3.destroy();this.$SphericalMediaController3=null;this.$SphericalMediaController4=true;};ea.prototype.$SphericalMediaController8=function(ga){if(ga.partialLeftDegrees||ga.partialRightDegrees||ga.partialTopDegrees||ga.partialBottomDegrees)return {partialLeftDegrees:ga.partialLeftDegrees,partialRightDegrees:ga.partialRightDegrees,partialTopDegrees:ga.partialTopDegrees,partialBottomDegrees:ga.partialBottomDegrees};return null;};ea.prototype.$SphericalMediaController15=function(ga){var ha=void 0;if(!ga.isFullScreen)ha=this.$SphericalMediaController8(ga);var ia=ga.initialYaw,ja=ga.initialPitch,ka=ga.initialFov;if(this.$SphericalMediaController4){var la=ga.viewStore.getState(),ma=la.view;ka=ma.fov;ja=ma.pitch;ia=ma.yaw;}return {initialHeading:ia,initialPitch:ja,fieldOfView:ka,keyboardVelocityFactor:ga.keyboardVelocityFactor,panningVelocityFactor:ga.panningVelocityFactor,enableZoom:ga.enableZoom,partialLimits:ha||undefined};};ea.prototype.$SphericalMediaController16=function(){return {disableAutoClientSizeUpdate:true,enableGyro:this.props.enableGyro,enableRubberBanding:this.props.enableRubberBanding,maxSpringDegrees:aa,maxStretchXDegrees:ba,maxStretchYDegrees:ca,minVFOV:this.props.maxTileLevel,rubberBandConstant:y,slipFactor:v,springFactor:z};};ea.prototype.$SphericalMediaController17=function(){var ga=c('performanceNow')();if(Math.abs(ga-this.$SphericalMediaController1)<x)return;var ha=this.$SphericalMediaController2;if(!ha)return;var ia=this.props.viewStore.getState(),ja=ia.view,ka=ja.yaw-ha.yaw,la=ja.pitch-ha.pitch,ma=Math.sqrt(Math.pow(ka,2)+Math.pow(la,2));if(w<ma){this.props.dispatch(o(ja));this.$SphericalMediaController1=ga;this.$SphericalMediaController2=babelHelpers['extends']({},ja);}};var fa=function ga(ha){return {caption:ha.base.caption,enableGyro:ha.base.enableGyro,enableRubberBanding:ha.base.enableRubberBanding,enableZoom:ha.base.enableZoom,height:ha.base.height,initialFov:ha.base.initialFov,initialPitch:ha.base.initialPitch,initialYaw:ha.base.initialYaw,isActive:ha.base.isRendererActive,isFullScreen:c('FullScreen').isFullScreen(),keyboardVelocityFactor:ha.base.keyboardVelocityFactor,maxTileLevel:ha.base.tiledSphericalConfig.maxTileLevel,panningVelocityFactor:ha.base.panningVelocityFactor,partialBottomDegrees:ha.base.partialBottomDegrees,partialLeftDegrees:ha.base.partialLeftDegrees,partialRightDegrees:ha.base.partialRightDegrees,partialTopDegrees:ha.base.partialTopDegrees,tags:ha.base.tags,viewStore:ha.base.viewStore,width:ha.base.width};};f.exports=k(fa)(ea);}),null);
__d('SphericalMediaBaseStore',['ReduxThunk','Redux'],(function a(b,c,d,e,f,g){'use strict';var h=c('Redux').compose,i=c('Redux').applyMiddleware,j=c('Redux').createStore,k=c('Redux').combineReducers;function l(){var m=arguments.length<=0||arguments[0]===undefined?[]:arguments[0],n=i.apply(undefined,[c('ReduxThunk')].concat(m)),o=k(this.getReducers());this.$SphericalMediaBaseStore1=h(n)(j)(o);}l.prototype.getStore=function(){return this.$SphericalMediaBaseStore1;};l.prototype.getReducers=function(){throw new Error('Implement _getReducers');};f.exports=l;}),null);
__d('SphericalMediaViewReducer',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';var h={fov:65,pitch:0,yaw:0,isAnimating:false},i=function j(){var k=arguments.length<=0||arguments[0]===undefined?h:arguments[0],l=arguments[1];if(l.namespace!==c('SphericalMediaActionNamespaces').VIEW)return k;var m={};switch(l.type){case c('SphericalMediaActions').UPDATE_VIEW:m=l.data;break;case c('SphericalMediaActions').UPDATE_VIEWPORT_AND_FOV:var n=l.data,o=n.pitch,p=n.fov,q=n.yaw;if(!isNaN(o+p+q)){m.fov=p;m.pitch=o;m.yaw=q;}break;case c('SphericalMediaActions').UPDATE_VIEWPORT:m=l.data;break;case c('SphericalMediaActions').UPDATE_FOV:m.fov=l.data.fov;break;case c('SphericalMediaActions').START_ANIMATING:m.isAnimating=true;break;case c('SphericalMediaActions').STOP_ANIMATING:m.isAnimating=false;break;}return babelHelpers['extends']({},k,m);};f.exports=i;}),null);
__d('SphericalMediaViewStore',['SphericalMediaBaseStore','SphericalMediaViewReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('SphericalMediaBaseStore'));i=h&&h.prototype;j.prototype.getReducers=function(){return {view:c('SphericalMediaViewReducer')};};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('SphericalMediaBaseRecord',['immutable','SphericalMediaViewStore','VideoProjection'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('VideoProjection').UNPADDED_CUBESTRIP,k=c('immutable').Record({keyboardVelocityFactor:0,panningVelocityFactor:0,enableGyro:false,enablePartialLimit:false,enableRubberBanding:false,enableZoom:false,partialLeftDegrees:undefined,partialRightDegrees:undefined,partialTopDegrees:undefined,partialBottomDegrees:undefined,isPanning:false,hasInteracted:false,visibility:true,aspectRatio:1,height:0,width:0,initialFov:65,initialPitch:0,initialYaw:0,renderer:null,isRendererActive:false,isRendererSetup:false,className:'',projectionType:j,expansionCoef:undefined,activeTag:null,tiledSphericalConfig:{useTiledRenderer:false,initialTileUris:[],maxTileLevel:0},canvasNamespace:'SphericalMedia',caption:'',type:'photo',src:'',flatImage:'',originalImageURI:'',thumbnail:'',fbid:'',loaded:false,enableSpherical:true,isFetchingData:false,photoSphereMetadata:{},useLocalSphericalImage:false,tags:[],surface:'',sessionID:'',viewStore:new (c('SphericalMediaViewStore'))().getStore()});h=babelHelpers.inherits(l,k);i=h&&h.prototype;function l(){h.apply(this,arguments);}f.exports=l;}),null);
__d('SphericalMediaBaseReducer',['SphericalMediaActionNamespaces','SphericalMediaActions','SphericalMediaBaseRecord','SphericalMediaViewStore'],(function a(b,c,d,e,f,g){'use strict';var h=function j(){return new (c('SphericalMediaBaseRecord'))({viewStore:new (c('SphericalMediaViewStore'))().getStore()});},i=function j(){var k=arguments.length<=0||arguments[0]===undefined?h():arguments[0],l=arguments[1];if(l.namespace!==c('SphericalMediaActionNamespaces').CORE&&l.namespace!==c('SphericalMediaActionNamespaces').BASE)return k;switch(l.type){case c('SphericalMediaActions').UPDATE_BASE:var m=l.data;return k.withMutations(function(v){v.merge(m);if(m.photoSphereMetadata)v.set('photoSphereMetadata',m.photoSphereMetadata);if(m.tiledSphericalConfig)v.set('tiledSphericalConfig',m.tiledSphericalConfig);if(m.tags)v.set('tags',m.tags);if(m.activeTag)v.set('activeTag',m.activeTag);});case c('SphericalMediaActions').DRAG_START:return k.withMutations(function(v){v.set('isPanning',true);v.set('hasInteracted',true);});case c('SphericalMediaActions').VISIBILITY_CHANGED:return k.set('visibility',l.data);case c('SphericalMediaActions').UPDATE_INITIAL_FOV:return k.set('initialFov',l.data.initialFov);case c('SphericalMediaActions').UPDATE_INITIAL_VIEWPORT:var n=l.data;return k.withMutations(function(v){v.set('initialYaw',n.initialYaw);v.set('initialPitch',n.initialPitch);});case c('SphericalMediaActions').UPDATE_DIMENSION:var o=l.data;return k.withMutations(function(v){v.set('height',o.height);v.set('width',o.width);v.set('aspectRatio',o.width/o.height);});case c('SphericalMediaActions').SETUP_RENDERER:var p=l.data.renderer;return k.withMutations(function(v){v.set('isRendererSetup',true);v.set('renderer',p);});case c('SphericalMediaActions').TURN_ON:return k.set('isRendererActive',true);case c('SphericalMediaActions').TURN_OFF:return k.withMutations(function(v){v.set('isRendererActive',false);v.set('isRendererSetup',false);v.set('renderer',null);});case c('SphericalMediaActions').REPLACE_BASE_STATE:return l.data;case c('SphericalMediaActions').SOURCE_ONLOAD:return k.set('loaded',true);case c('SphericalMediaActions').DISABLE_SPHERICAL:return k.set('enableSpherical',false);case c('SphericalMediaActions').ENABLE_SPHERICAL:return k.set('enableSpherical',true);case c('SphericalMediaActions').REQUEST_PHOTO:return k.withMutations(function(v){v.set('loaded',false);v.set('isFetchingData',true);});case c('SphericalMediaActions').RECEIVE_PHOTO:var q=l.data,r=q.partialLimits;return k.withMutations(function(v){v.set('fbid',q.photoID);v.set('flatImage',q.flatImage);v.set('initialFov',q.initialFov);v.set('initialPitch',q.initialPitch);v.set('initialYaw',q.initialYaw);v.set('isFetchingData',false);v.set('originalImageURI',q.originalImageURI);v.set('partialBottomDegrees',r.partialBottomDegrees);v.set('partialLeftDegrees',r.partialLeftDegrees);v.set('partialRightDegrees',r.partialRightDegrees);v.set('partialTopDegrees',r.partialTopDegrees);v.set('src',q.src);v.set('thumbnail',q.thumbnail);});case c('SphericalMediaActions').UPDATE_SPATIAL_TAGS:var s=l.data;return k.withMutations(function(v){v.set('tags',s);});case c('SphericalMediaActions').UPDATE_ACTIVE_SPATIAL_TAG:var t=l.data;return k.withMutations(function(v){v.set('activeTag',t);});case c('SphericalMediaActions').UPDATE_RESIZED_FILE_URL:var u=l.data;return k.withMutations(function(v){v.set('src',u);});}return k;};f.exports=i;}),null);
__d('SphericalPhotoActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';f.exports={rendererStats:function h(i){return {namespace:c('SphericalMediaActionNamespaces').PHOTO,type:c('SphericalMediaActions').PHOTO_RENDERER_STATS,data:i};}};}),null);
__d('CubemapImageTile',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j){this.$CubemapImageTile1=i;this.$CubemapImageTile2=j;}h.prototype.getInfo=function(){return this.$CubemapImageTile1;};h.prototype.getImg=function(){return this.$CubemapImageTile2;};f.exports=h;}),null);
__d('CubemapImageTileInfo',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k,l){this.level=i;this.face=j;this.col=k;this.row=l;}h.prototype.getKey=function(){return ''+this.level+'_'+this.face+'_'+this.col+'_'+this.row;};h.prototype.getInfoForOffsetLevel=function(i){var j=this.level-i;if(j<0)throw new Error('Invalid level offset for getKeyForOffsetLevel: '+i+', max offset: '+this.level);var k=Math.floor(this.col/Math.pow(2,i)),l=Math.floor(this.row/Math.pow(2,i));return new h(j,this.face,k,l);};f.exports=h;}),null);
__d('CubemapImageTileProvider',['CubemapImageTile','CubemapImageTileInfo','Map','performanceNow','SphericalMediaConstants'],(function a(b,c,d,e,f,g){'use strict';var h=c('SphericalMediaConstants').TILED_CUBE_FACES,i=c('SphericalMediaConstants').TILED_CUBE_TILE_CONTENT_SIZE,j=c('SphericalMediaConstants').TILED_CUBE_TILE_PADDING_PIXELS;function k(l,m){this.$CubemapImageTileProvider10=function(n,o,p){var q=new Image(),r=new (c('CubemapImageTile'))(n,q);q.crossOrigin='anonymous';q.onload=function(){return this.$CubemapImageTileProvider11(r,p);}.bind(this);q.src=o;}.bind(this);this.$CubemapImageTileProvider1=l;this.$CubemapImageTileProvider6=0;this.$CubemapImageTileProvider7={};this.$CubemapImageTileProvider2=false;this.$CubemapImageTileProvider3=[];this.$CubemapImageTileProvider4=[];this.$CubemapImageTileProvider5=new (c('Map'))();this.$CubemapImageTileProvider8=m;this.$CubemapImageTileProvider9();}k.prototype.getTileContentSize=function(){return i;};k.prototype.getTilePaddingPixels=function(){return j;};k.prototype.getTileTotalSize=function(){return 2*j+i;};k.prototype.getMaxTileLevel=function(){return this.$CubemapImageTileProvider8;};k.prototype.getTotalPixelsLoaded=function(){return this.$CubemapImageTileProvider6*Math.pow(this.getTileTotalSize(),2);};k.prototype.getBaseLevelImageTiles=function(){return this.$CubemapImageTileProvider5;};k.prototype.addBaseLevelReadyCallback=function(l){if(!this.$CubemapImageTileProvider2){this.$CubemapImageTileProvider3.push(l);}else l();};k.prototype.isBaseLevelReady=function(){return this.$CubemapImageTileProvider2;};k.prototype.loadTileImage=function(l,m,n){var o=l.getKey();if(o in this.$CubemapImageTileProvider7){m(this.$CubemapImageTileProvider7[o],n);}else this.$CubemapImageTileProvider1.getUriForTile(l,function(p,q){this.$CubemapImageTileProvider10(p,q,m);}.bind(this));};k.prototype.$CubemapImageTileProvider9=function(){this.$CubemapImageTileProvider4=[new (c('CubemapImageTileInfo'))(0,h.PLUS_X,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_X,0,0),new (c('CubemapImageTileInfo'))(0,h.PLUS_Y,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_Y,0,0),new (c('CubemapImageTileInfo'))(0,h.PLUS_Z,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_Z,0,0)];this.$CubemapImageTileProvider4.forEach(function(l){return this.$CubemapImageTileProvider1.getUriForTile(l,this.$CubemapImageTileProvider10);}.bind(this));};k.prototype.$CubemapImageTileProvider11=function(l,m){var n=l.getInfo().getKey();this.$CubemapImageTileProvider7[n]=l;this.$CubemapImageTileProvider6++;if(!this.$CubemapImageTileProvider2){var o=this.$CubemapImageTileProvider4.every(function(p){return p.getKey() in this.$CubemapImageTileProvider7;}.bind(this));if(l.getInfo().level===0)this.$CubemapImageTileProvider5.set(l.getInfo().getKey(),l);if(o)this.$CubemapImageTileProvider12();}else m&&m(l,c('performanceNow')());};k.prototype.$CubemapImageTileProvider12=function(){this.$CubemapImageTileProvider2=true;this.$CubemapImageTileProvider3.forEach(function(l){return l();});};f.exports=k;}),null);
__d('BaseCubemapTileUriProvider',['invariant','CubemapImageTileInfo'],(function a(b,c,d,e,f,g,h){'use strict';i.prototype.getUriForTile=function(j,k){h(0);};function i(){}f.exports=i;}),null);
__d("XSphericalPhotoTileURIsAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/spherical_media\/photo\/tile\/",{});}),null);
__d('EntPhotoCubemapTileUriProvider',['Promise','BaseCubemapTileUriProvider','CubemapImageTileInfo','Map','XAsyncRequest','XSphericalPhotoTileURIsAsyncController','throttle'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=200;h=babelHelpers.inherits(k,c('BaseCubemapTileUriProvider'));i=h&&h.prototype;function k(l,m){i.constructor.call(this);this.$EntPhotoCubemapTileUriProvider9=c('throttle')(function(){this.$EntPhotoCubemapTileUriProvider10(this.$EntPhotoCubemapTileUriProvider3);this.$EntPhotoCubemapTileUriProvider3=new (c('Map'))();}.bind(this),j);this.$EntPhotoCubemapTileUriProvider1=l;this.$EntPhotoCubemapTileUriProvider2=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider3=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider4=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider5=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider7(m);this.$EntPhotoCubemapTileUriProvider6=0;}k.prototype.getUriForTile=function(l,m){var n=l.getKey(),o=this.$EntPhotoCubemapTileUriProvider2.get(n);if(!o){if(this.$EntPhotoCubemapTileUriProvider5.has(n))return;this.$EntPhotoCubemapTileUriProvider8({tileInfo:l,onURIfetched:m});}else m(l,o);};k.prototype.$EntPhotoCubemapTileUriProvider8=function(l){var m=l.tileInfo.getKey(),n=this.$EntPhotoCubemapTileUriProvider3.get(m),o=this.$EntPhotoCubemapTileUriProvider4.get(m);if(!n&&!o){this.$EntPhotoCubemapTileUriProvider3.set(m,l);this.$EntPhotoCubemapTileUriProvider9();}};k.prototype.$EntPhotoCubemapTileUriProvider10=function(l){if(l.size===0)return new (c('Promise'))(function(){});var m=[];l.forEach(function(o){var p=o.tileInfo;this.$EntPhotoCubemapTileUriProvider4.set(p.getKey(),p);m.push({level:p.level,face:p.face,col:p.col,row:p.row});}.bind(this));var n={photo_id:this.$EntPhotoCubemapTileUriProvider1,tile_info_list:m};return this.$EntPhotoCubemapTileUriProvider11(c('XSphericalPhotoTileURIsAsyncController').getURIBuilder().getURI(),n).then(function(o){this.$EntPhotoCubemapTileUriProvider7(o.payload);l.forEach(function(p){var q=p.tileInfo,r=p.onURIfetched,s=q.getKey(),t=this.$EntPhotoCubemapTileUriProvider2.get(s);if(t){r(q,t);}else this.$EntPhotoCubemapTileUriProvider5.set(s,true);this.$EntPhotoCubemapTileUriProvider4['delete'](s);}.bind(this));}.bind(this),function(o){}.bind(this));};k.prototype.$EntPhotoCubemapTileUriProvider11=function(l,m){return new (c('Promise'))(function(n,o){return new (c('XAsyncRequest'))(l).setMethod('POST').setData(m).setHandler(n).setErrorHandler(o).send();});};k.prototype.$EntPhotoCubemapTileUriProvider7=function(l){l.forEach(function(m){var n=new (c('CubemapImageTileInfo'))(m.level,m.face,m.col,m.row);this.$EntPhotoCubemapTileUriProvider2.set(n.getKey(),m.uri);}.bind(this));};f.exports=k;}),null);
__d('StaticCubemapTileUriProvider',['BaseCubemapTileUriProvider','CubemapImageTileInfo','Map'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('BaseCubemapTileUriProvider'));i=h&&h.prototype;function j(k){i.constructor.call(this);this.$StaticCubemapTileUriProvider1=new (c('Map'))();k.forEach(function(l){var m=new (c('CubemapImageTileInfo'))(l.level,l.face,l.col,l.row);this.$StaticCubemapTileUriProvider1.set(m.getKey(),l.uri);}.bind(this));}j.prototype.getUriForTile=function(k,l){var m=k.getKey(),n=this.$StaticCubemapTileUriProvider1.get(m);n&&l(k,n);};f.exports=j;}),null);
__d('BaseRotatableWebGLRenderer',['EventEmitter','EventListener','getErrorNameFromWebGLErrorCode','performanceNow','Map','GLMatrix','radToDeg'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('GLMatrix').glMatrix,k=c('GLMatrix').mat4,l=Math.max(window.devicePixelRatio||1,1),m=179;h=babelHelpers.inherits(n,c('EventEmitter'));i=h&&h.prototype;function n(o){i.constructor.call(this);this.__handleContextLost=function(q){q.preventDefault();this.emit('renderingContextLost');this.__contextLost=true;}.bind(this);this.__handleContextRestore=function(q){this.__setup();this.emit('renderingContextRestore');}.bind(this);if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var p in this.constructor.__subClassMethods)if(typeof this[p]!=='function')throw new Error('Must implement "'+p+'"');this.__firstRenderTime=-1;this.__previousRenderFinishTime=-1;this.__sumOfRenderTimes=0;this.__framesRenderedCount=0;this.__sumTextureScreenRatioValues=0;this.__textureScreenRatioMillisCounted=0;this.__canvas=o;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__shaders=[];this.__contextLost=false;this.__horizontalFieldOfView=0;this.__verticalFieldOfView=0;this.__perspectiveMatrix=k.create();this.__rotationMatrix=k.create();this.__canvas.addEventListener('webglcontextlost',this.__handleContextLost);this.__canvas.addEventListener('webglcontextrestored',this.__handleContextRestore);}n.prototype.destroy=function(){this.__canvas.removeEventListener('webglcontextlost',this.__handleContextLost);this.__canvas.removeEventListener('webglcontextrestored',this.__handleContextRestore);this.__shaders.forEach(function(o){try{this.__gl.detachShader(this.__shaderProgram,o);}catch(p){}}.bind(this));this.__shaders=[];this.__clearCache();};n.prototype.updateFieldOfView=function(o){var p=Math.min(m,Math.min(o,m/this.__aspectRatio));this.__verticalFieldOfView=p;this.__updateHorizontalFieldOfView();this.__updatePerspective();};n.prototype.updateViewportDimensions=function(o,p){this.__canvas.width=o*l;this.__canvas.height=p*l;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__updateHorizontalFieldOfView();this.__updatePerspective();};n.prototype.hasRenderingContext=function(){return !this.__contextLost;};n.prototype.getScreenshotDataURL=function(o,p,q){if(!this.__gl||this.__contextLost)return '';this.render(o);return this.__canvas.toDataURL(p,q);};n.prototype.getAverageFrameRenderTimeMillis=function(){if(this.__framesRenderedCount===0)return 0;return this.__sumOfRenderTimes/this.__framesRenderedCount;};n.prototype.getMaxGPUMemoryUsedBytes=function(){return this.__getMaxGPUMemoryUsedBytes();};n.prototype.getAverageTextureToScreenPixelRatio=function(){if(this.__textureScreenRatioMillisCounted===0)return 0;return this.__sumTextureScreenRatioValues/this.__textureScreenRatioMillisCounted;};n.prototype.getTimeSinceFirstRenderMillis=function(){return c('performanceNow')()-this.__firstRenderTime;};n.prototype.renderErrorCheck=function(){this.__createTexture();};n.prototype.render=function(o){if(this.__contextLost)return;if(!this.__isValidView(o)){this.emit('renderingError',new Error('invalid view'),o);return;}var p=c('performanceNow')();if(this.__firstRenderTime===-1)this.__firstRenderTime=p;if(o.fov!==this.__verticalFieldOfView)this.updateFieldOfView(o.fov);k.identity(this.__rotationMatrix);k.rotateX(this.__rotationMatrix,this.__rotationMatrix,-j.toRadian(o.pitch));k.rotateY(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(o.yaw));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);var q=this.__getPrevFrameTextureScreenRatio();this.__renderInternal();var r=c('performanceNow')();this.__sumOfRenderTimes+=r-p;this.__framesRenderedCount+=1;if(this.__previousRenderFinishTime>0){var s=2000,t=Math.min(r-this.__previousRenderFinishTime,s);this.__sumTextureScreenRatioValues+=t*q;this.__textureScreenRatioMillisCounted+=t;}this.__previousRenderFinishTime=r;};n.prototype.renderWithRotationMatrix=function(o){if(this.__contextLost)return;this.__rotationMatrix=o;this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);this.__renderInternal();};n.prototype.__isValidView=function(o){return !Number.isNaN(o.fov+o.pitch+o.yaw);};n.prototype.__copyTextureToGLBuffer=function(o,p){var q=arguments.length<=2||arguments[2]===undefined?false:arguments[2],r=this.__getNewGLTexObj(p);this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,q);this.__gl.bindTexture(this.__gl.TEXTURE_2D,r);this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,o.image);var s=this.__gl.getError();if(s!==0)this.emit('renderingError','WebGL Error Code: '+s);return r;};n.prototype.__setup=function(){if(!this.__gl||!this.__contextLost){this.__gl=this.__getGL();this.__contextLost=false;}this.__gl.clearColor(0,0,0,1);this.updateViewportDimensions(this.__canvas.clientWidth,this.__canvas.clientHeight);var o=this.__initShaders();if(!o.success){var p=c('getErrorNameFromWebGLErrorCode')(this.__gl.getError());throw new Error('\n        Failed to intialize shaders: '+p+'\n        Error Message: '+o.error+'\n      ');}};n.prototype.__getGL=function(){if(this.__gl&&!this.__contextLost)return this.__gl;if(!b.WebGLRenderingContext)throw new Error('WebGLRenderingContext not available.');var o=['webgl','experimental-webgl','webkit-3d','moz-webgl'],p=null,q=null,r=c('EventListener').listen(this.__canvas,'webglcontextcreationerror',function(u){return q=u.statusMessage;});for(var s=0;s<o.length;s++){try{p=this.__canvas.getContext(o[s]);}catch(t){}if(p)break;}r.remove();if(!p){q=q||'Unknown error.';throw new Error('Failed to acquire 3D rendering context: '+q);}return p;};n.prototype.__updatePerspective=function(){k.perspective(this.__perspectiveMatrix,j.toRadian(this.__verticalFieldOfView),this.__aspectRatio,.1,100);this.__gl.viewport(0,0,this.__gl.drawingBufferWidth,this.__gl.drawingBufferHeight);};n.prototype.__initShaders=function(){this.__shaderProgram=this.__gl.createProgram();try{this.__attachShaders(this.__shaderProgram);}catch(o){return {success:false,error:'Shader: '+o.message};}this.__gl.linkProgram(this.__shaderProgram);var p=this.__gl.getProgramParameter(this.__shaderProgram,this.__gl.LINK_STATUS);if(!p)return {success:false,error:'No link. Could not initialize shaders'};this.__gl.useProgram(this.__shaderProgram);this.__setShaderMatrixPointers();this.__shaderProgramReady();return {success:true,error:''};};n.prototype.__setShaderMatrixPointers=function(){this.__shaderPMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderPerspectiveMatrixUniformName());this.__shaderRotMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderRotationMatrixUniformName());};n.prototype.__getShaderConfigs=function(){var o=new (c('Map'))();o.set(this.__gl.VERTEX_SHADER,this.__getVertexShaderScript());o.set(this.__gl.FRAGMENT_SHADER,this.__getFragmentShaderScript());return o;};n.prototype.__attachShaders=function(o){var p=this.__getShaderConfigs();p.forEach(function(q,r){var s=this.__gl.createShader(r);this.__gl.shaderSource(s,q);this.__gl.compileShader(s);if(!this.__gl.getShaderParameter(s,this.__gl.COMPILE_STATUS))throw new Error(this.__gl.getShaderInfoLog(s));this.__gl.attachShader(o,s);this.__shaders.push(s);}.bind(this));};n.prototype.__getNewGLTexObj=function(o){var p=this.__gl.createTexture();this.__gl.bindTexture(o,p);this.__gl.texParameteri(o,this.__gl.TEXTURE_MAG_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_MIN_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_S,this.__gl.CLAMP_TO_EDGE);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_T,this.__gl.CLAMP_TO_EDGE);this.__gl.bindTexture(o,null);return p;};n.prototype.__updateHorizontalFieldOfView=function(){var o=j.toRadian(this.__verticalFieldOfView),p=2*Math.atan(Math.tan(o/2)*this.__aspectRatio);this.__horizontalFieldOfView=c('radToDeg')(p);};f.exports=n;}),null);
__d('TiledSphericalRenderer',['CubemapImageTileInfo','BaseRotatableWebGLRenderer','performanceNow','Map','GLMatrix','debounceCore','SphericalMediaConstants'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('GLMatrix').glMatrix,k=c('GLMatrix').mat4,l=c('GLMatrix').vec3,m=c('SphericalMediaConstants').TILED_CUBE_FACES,n=44;h=babelHelpers.inherits(o,c('BaseRotatableWebGLRenderer'));i=h&&h.prototype;function o(p,q,r){i.constructor.call(this,p);this.$TiledSphericalRenderer28=function(s,t){var u=s.getInfo().getKey();this.$TiledSphericalRenderer7.set(u,s);if(t!==this.$TiledSphericalRenderer9){this.$TiledSphericalRenderer9=this.$TiledSphericalRenderer8;setTimeout(this.$TiledSphericalRenderer29,0);}}.bind(this);this.$TiledSphericalRenderer30=c('debounceCore')(function(){return this.__renderInternal();}.bind(this),30);this.$TiledSphericalRenderer29=c('debounceCore')(function(){var s=this.$TiledSphericalRenderer7;this.$TiledSphericalRenderer7=new (c('Map'))();this.$TiledSphericalRenderer21().forEach(function(t){return (setTimeout(function(){return this.$TiledSphericalRenderer31(t,s);}.bind(this),0));}.bind(this));}.bind(this),100);this.$TiledSphericalRenderer1=q;this.$TiledSphericalRenderer2=r;this.$TiledSphericalRenderer3=1;this.$TiledSphericalRenderer6=0;this.$TiledSphericalRenderer8=0;this.$TiledSphericalRenderer9=0;this.$TiledSphericalRenderer4=new (c('Map'))();this.$TiledSphericalRenderer5=new (c('Map'))();this.$TiledSphericalRenderer7=new (c('Map'))();this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer18();this.__setup();}o.prototype.__clearCache=function(){this.$TiledSphericalRenderer5.forEach(function(p){this.__gl.deleteTexture(p);}.bind(this));this.$TiledSphericalRenderer5.clear();this.$TiledSphericalRenderer4.forEach(function(p){this.__gl.deleteTexture(p.texture);}.bind(this));this.$TiledSphericalRenderer4.clear();};o.prototype.__getShaderPerspectiveMatrixUniformName=function(){return 'uPMatrix';};o.prototype.__getShaderRotationMatrixUniformName=function(){return 'uRotationMatrix';};o.prototype.__shaderProgramReady=function(){this.$TiledSphericalRenderer13=this.__gl.getAttribLocation(this.__shaderProgram,'aVertexPosition');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer13);this.$TiledSphericalRenderer14=this.__gl.getAttribLocation(this.__shaderProgram,'aTextureCoord');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer14);this.$TiledSphericalRenderer15=this.__gl.getAttribLocation(this.__shaderProgram,'aBGTextureCoord');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer15);var p=this.__gl.getUniformLocation(this.__shaderProgram,'uContentSampler'),q=this.__gl.getUniformLocation(this.__shaderProgram,'uBackgroundSampler'),r=0;this.$TiledSphericalRenderer16=this.__gl.TEXTURE0;var s=1;this.$TiledSphericalRenderer17=this.__gl.TEXTURE1;this.__gl.uniform1i(p,r);this.__gl.uniform1i(q,s);this.$TiledSphericalRenderer19();};o.prototype.__getVertexShaderScript=function(){return '\n      attribute vec3 aVertexPosition;\n      attribute vec2 aTextureCoord;\n      attribute vec2 aBGTextureCoord;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vTextureCoord = aTextureCoord;\n        vBGTextureCoord = aBGTextureCoord;\n      }\n    ';};o.prototype.__getFragmentShaderScript=function(){return '\n    #define PI 3.1415926538\n\n    // 1 degree blend zone\n    const highp float blendDist = PI / 180.0;\n\n    varying highp vec2 vTextureCoord;\n    varying highp vec2 vBGTextureCoord;\n\n    varying highp vec3 vCurrentRay;\n    uniform highp vec2 uHorizontalAngleBounds;\n    uniform highp vec2 uVerticleAngleBounds;\n\n    uniform sampler2D uContentSampler;\n    uniform sampler2D uBackgroundSampler;\n\n    void main(void) {\n      highp float x = vCurrentRay[0];\n      highp float y = vCurrentRay[1];\n      highp float z = vCurrentRay[2];\n      highp float hAngle = atan(x, -1.0 * z);\n      highp float vAngle = atan(y * inversesqrt(x*x + z*z));\n\n      // if current ray is inside the content bounds, use the content sampler\n      // to set the fragment color. if it is not within the bounds, use the\n      // background sampler to set the color.*\n\n      highp float hdist = 0.0;\n      highp float vdist = 0.0;\n      if (hAngle < uHorizontalAngleBounds[0]) {\n        hdist = uHorizontalAngleBounds[0] - hAngle;\n      } else if (hAngle > uHorizontalAngleBounds[1]) {\n        hdist = hAngle - uHorizontalAngleBounds[1];\n      }\n      if (vAngle < uVerticleAngleBounds[0]) {\n        vdist = uVerticleAngleBounds[0] - vAngle;\n      } else if (vAngle > uVerticleAngleBounds[1]) {\n        vdist = vAngle - uVerticleAngleBounds[1];\n      }\n      highp float maxDist = max(hdist, vdist);\n      if (maxDist > 0.0) {\n        // Inside this condition, our fragment is outside the content bounds.\n        // The distance outside the bound is represented by maxDist. It could\n        // be the horizontal or vertical distance from a bound, whichever is\n        // larger. We will use this distance to blend the content with the\n        // background, if the distance is smaller than blendDist. If it is\n        // larger than blendDist, we will use purely the background tex to\n        // set the color. If dist is within the blendDist, then we will set\n        // the color to the linearly weighted avg across the blend zone of the\n        // background and content colors.\n        //\n        highp vec4 bgColor = texture2D(\n          uBackgroundSampler,\n          vec2(vBGTextureCoord.s, vBGTextureCoord.t)\n        );\n        if (maxDist < blendDist) {\n          highp float contentWeight = (blendDist - maxDist) / blendDist;\n          highp vec4 contentColor = texture2D(\n            uContentSampler,\n            vec2(vTextureCoord.s, vTextureCoord.t)\n          );\n          gl_FragColor = mix(bgColor, contentColor, contentWeight);\n        } else {\n          // We are outside the blend zone. Just use background.\n          gl_FragColor = bgColor;\n        }\n      } else {\n        // In this condition, we are inside the content, so we just take the\n        // color from the content texture.\n        gl_FragColor = texture2D(\n          uContentSampler,\n          vec2(vTextureCoord.s, vTextureCoord.t)\n        );\n      }\n    }\n    ';};o.prototype.__getMaxGPUMemoryUsedBytes=function(){var p=this.$TiledSphericalRenderer1.getTileTotalSize(),q=4,r=this.$TiledSphericalRenderer4.size+this.$TiledSphericalRenderer5.size;return p*p*q*r;};o.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledSphericalRenderer6;};o.prototype.__createTexture=function(){if(this.$TiledSphericalRenderer5.size===0&&this.$TiledSphericalRenderer1.isBaseLevelReady())this.$TiledSphericalRenderer20();};o.prototype.__renderInternal=function(){if(!this.$TiledSphericalRenderer1.isBaseLevelReady())return;this.__createTexture();this.$TiledSphericalRenderer8=c('performanceNow')();var p=this.$TiledSphericalRenderer21(),q=0;p.forEach(function(s){q+=this.$TiledSphericalRenderer22(s);}.bind(this));var r=p.length>0?p.length:1;q/=r;this.$TiledSphericalRenderer6=q;};o.prototype.$TiledSphericalRenderer19=function(){var p=this.__gl.getUniformLocation(this.__shaderProgram,'uHorizontalAngleBounds'),q=this.__gl.getUniformLocation(this.__shaderProgram,'uVerticleAngleBounds'),r=this.$TiledSphericalRenderer2.partialLeftDegrees,s=this.$TiledSphericalRenderer2.partialRightDegrees,t=this.$TiledSphericalRenderer2.partialTopDegrees,u=this.$TiledSphericalRenderer2.partialBottomDegrees,v=r!==undefined&&r!==null?-1*r:-181,w=s!==undefined&&s!==null?s:181,x=u!==undefined&&u!==null?-1*u:-91,y=t!==undefined&&t!==null?t:91,z=new Float32Array([j.toRadian(v),j.toRadian(w)]),aa=new Float32Array([j.toRadian(x),j.toRadian(y)]);this.__gl.uniform2fv(p,z);this.__gl.uniform2fv(q,aa);};o.prototype.$TiledSphericalRenderer21=function(){var p=this.$TiledSphericalRenderer23(),q=this.$TiledSphericalRenderer24(),r=Math.pow(2,p),s=2*this.$TiledSphericalRenderer3/r,t=[];for(var u=0;u<q.length;u++){var v=q[u];if(v){var w=Math.floor(v.minX/s),x=Math.min(Math.floor(v.maxX/s),r-1),y=Math.floor(v.minY/s),z=Math.min(Math.floor(v.maxY/s),r-1);for(var aa=w;aa<=x;aa++)for(var ba=y;ba<=z;ba++)t.push(new (c('CubemapImageTileInfo'))(p,u,aa,ba));}}return t;};o.prototype.$TiledSphericalRenderer23=function(){var p=this.__verticalFieldOfView,q=this.__horizontalFieldOfView,r=this.__canvas.height/p,s=3400/2,t=0,u=this.$TiledSphericalRenderer1.getTileContentSize()/90,v=1.4;while(u*v<r&&u*p<s&&u*q<s){t++;u*=2;}return Math.min(t,this.$TiledSphericalRenderer1.getMaxTileLevel());};o.prototype.$TiledSphericalRenderer24=function(){var p=j.toRadian(this.__verticalFieldOfView),q=j.toRadian(this.__horizontalFieldOfView),r=1,s=Math.tan(q/2)*r,t=Math.tan(p/2)*r,u=[l.fromValues(-s,t,-r),l.fromValues(s,t,-r),l.fromValues(s,-t,-r),l.fromValues(-s,-t,-r)],v=k.create();k.invert(v,this.__rotationMatrix);this.$TiledSphericalRenderer25(v,u);var w=[];for(var x=0;x<6;x++){var y=this.$TiledSphericalRenderer12[x],z=[];for(var aa=0;aa<y.length;aa++)z.push(l.clone(y[aa]));var ba=this.$TiledSphericalRenderer26(z,u);if(ba.length>0){var ca=k.create();k.invert(ca,this.$TiledSphericalRenderer11[x]);this.$TiledSphericalRenderer25(ca,ba);var da=ba[0],ea=da[0],fa=da[0],ga=da[1],ha=da[1];for(var ia=1;ia<ba.length;ia++){da=ba[ia];ea=Math.min(ea,da[0]);fa=Math.max(fa,da[0]);ga=Math.min(ga,da[1]);ha=Math.max(ha,da[1]);}w[x]={minX:this.$TiledSphericalRenderer3+ea,maxX:this.$TiledSphericalRenderer3+fa,minY:this.$TiledSphericalRenderer3-ha,maxY:this.$TiledSphericalRenderer3-ga};}}return w;};o.prototype.$TiledSphericalRenderer25=function(p,q){for(var r=0;r<q.length;r++)l.transformMat4(q[r],q[r],p);};o.prototype.$TiledSphericalRenderer26=function(p,q){var r=q[q.length-1];for(var s=0;s<q.length;s++){var t=q[s],u=[],v=l.create();l.cross(v,r,t);var w=p[p.length-1],x=l.dot(v,w),y=x>=0;for(var z=0;z<p.length;z++){var aa=p[z],ba=l.dot(v,aa),ca=ba>=0;if(ca!==y){var da=this.$TiledSphericalRenderer27(w,x,aa,ba);if(!l.exactEquals(w,da)&&!l.exactEquals(aa,da))u.push(da);}if(ca)u.push(aa);w=aa;x=ba;y=ca;}p=u;if(p.length===0)break;r=t;}return p;};o.prototype.$TiledSphericalRenderer27=function(p,q,r,s){var t=-q/(s-q),u=l.create();l.subtract(u,r,p);l.scale(u,u,t);l.add(u,u,p);return u;};o.prototype.$TiledSphericalRenderer31=function(p,q){var r=p.getKey(),s=q.get(r);if(s){this.$TiledSphericalRenderer32(s);this.$TiledSphericalRenderer30();}};o.prototype.$TiledSphericalRenderer22=function(p){var q=2*this.$TiledSphericalRenderer3,r=this.$TiledSphericalRenderer3,s=Math.pow(2,p.level),t=q/s,u=p.col*t,v=p.row*t,w=-r+u,x=w+t,y=r-v,z=y-t,aa=[[w,y,-r],[x,y,-r],[w,z,-r],[x,z,-r]],ba=this.$TiledSphericalRenderer11[p.face],ca=[];for(var da=0;da<aa.length;da++){l.transformMat4(aa[da],aa[da],ba);ca.push(aa[da][0]);ca.push(aa[da][1]);ca.push(aa[da][2]);}this.$TiledSphericalRenderer33(this.$TiledSphericalRenderer13,ca,3);this.__gl.activeTexture(this.$TiledSphericalRenderer16);var ea=this.$TiledSphericalRenderer34(p),fa=this.$TiledSphericalRenderer35(p,ea);this.$TiledSphericalRenderer33(this.$TiledSphericalRenderer14,fa,2);this.__gl.activeTexture(this.$TiledSphericalRenderer17);var ga=new (c('CubemapImageTileInfo'))(0,p.face,0,0),ha=this.$TiledSphericalRenderer5.get(ga.getKey());if(!ha)throw new Error('[Tile] Base level should have been loaded.');this.__gl.bindTexture(this.__gl.TEXTURE_2D,ha);var ia=this.$TiledSphericalRenderer35(p,ga);this.$TiledSphericalRenderer33(this.$TiledSphericalRenderer15,ia,2);this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,ca.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledSphericalRenderer10.forEach(function(ja){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,ja);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW);this.__gl.deleteBuffer(ja);}.bind(this));this.$TiledSphericalRenderer10=[];return this.$TiledSphericalRenderer36(ea.level);};o.prototype.$TiledSphericalRenderer33=function(p,q,r){var s=this.__gl.createBuffer();this.$TiledSphericalRenderer10.push(s);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,s);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(q),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(p,r,this.__gl.FLOAT,false,0,0);};o.prototype.$TiledSphericalRenderer36=function(p){var q=this.__canvas.height/this.__verticalFieldOfView,r=90/Math.pow(2,p),s=this.$TiledSphericalRenderer1.getTileContentSize()/r;return s/q;};o.prototype.$TiledSphericalRenderer35=function(p,q){var r=this.$TiledSphericalRenderer1.getTilePaddingPixels(),s=r/this.$TiledSphericalRenderer1.getTileTotalSize(),t=this.$TiledSphericalRenderer1.getTileContentSize()/this.$TiledSphericalRenderer1.getTileTotalSize(),u=Math.pow(2,p.level-q.level),v=t/u,w=p.col-u*q.col,x=p.row-u*q.row,y=s+w*v,z=s+x*v;return [y,z,y+v,z,y,z+v,y+v,z+v];};o.prototype.$TiledSphericalRenderer34=function(p){var q=0;while(q<=p.level){var r=p.getInfoForOffsetLevel(q),s=r.getKey(),t=void 0;if(r.level===0){t={lastUsedTime:0,texture:this.$TiledSphericalRenderer5.get(s)};}else t=this.$TiledSphericalRenderer4.get(s);if(t){this.__gl.bindTexture(this.__gl.TEXTURE_2D,t.texture);t.lastUsedTime=this.$TiledSphericalRenderer8;return r;}else this.$TiledSphericalRenderer1.loadTileImage(r,this.$TiledSphericalRenderer28,this.$TiledSphericalRenderer8);q++;}throw new Error('No possible tile for requested params: '+p.getKey());};o.prototype.$TiledSphericalRenderer20=function(){var p=this.$TiledSphericalRenderer1.getBaseLevelImageTiles();p.forEach(function(q){var r=this.__copyTextureToGLBuffer({image:q.getImg()},this.__gl.TEXTURE_2D),s=this.__gl.getError();if(s!==0)this.emit('renderingError','WebGL Error Code: '+s);this.$TiledSphericalRenderer5.set(q.getInfo().getKey(),r);}.bind(this));};o.prototype.$TiledSphericalRenderer32=function(p){var q,r=this,s=p.getInfo().getKey(),t=this.$TiledSphericalRenderer4.get(s);if(!t){var u=this.__copyTextureToGLBuffer({image:p.getImg()},this.__gl.TEXTURE_2D),v=this.__gl.getError();if(v!==0)this.emit('renderingError','WebGL Error Code: '+v);t={texture:u,lastUsedTime:c('performanceNow')()};this.$TiledSphericalRenderer4.set(s,t);if(this.$TiledSphericalRenderer4.size>n)(function(){var w=s,x=t;r.$TiledSphericalRenderer4.forEach(function(y,z){if(y.lastUsedTime<x.lastUsedTime){w=z;x=y;}});r.__gl.deleteTexture(x.texture);r.$TiledSphericalRenderer4['delete'](w);})();}};o.prototype.$TiledSphericalRenderer18=function(){this.$TiledSphericalRenderer11=[];var p=k.create();k.identity(p);k.rotateY(p,p,j.toRadian(-90));this.$TiledSphericalRenderer11[m.PLUS_X]=p;var q=k.create();k.identity(q);k.rotateY(q,q,j.toRadian(90));this.$TiledSphericalRenderer11[m.MINUS_X]=q;var r=k.create();k.identity(r);k.rotateZ(r,r,j.toRadian(180));k.rotateX(r,r,j.toRadian(-90));this.$TiledSphericalRenderer11[m.PLUS_Y]=r;var s=k.create();k.identity(s);k.rotateZ(s,s,j.toRadian(180));k.rotateX(s,s,j.toRadian(90));this.$TiledSphericalRenderer11[m.MINUS_Y]=s;var t=k.create();k.identity(t);k.rotateY(t,t,j.toRadian(180));this.$TiledSphericalRenderer11[m.PLUS_Z]=t;var u=k.create();k.identity(u);this.$TiledSphericalRenderer11[m.MINUS_Z]=u;this.$TiledSphericalRenderer12=[];var v=this.$TiledSphericalRenderer3,w=[l.fromValues(-v,v,-v),l.fromValues(v,v,-v),l.fromValues(v,-v,-v),l.fromValues(-v,-v,-v)];for(var x=0;x<6;x++){var y=this.$TiledSphericalRenderer11[x],z=[];for(var aa=0;aa<w.length;aa++){var ba=l.create();l.transformMat4(ba,w[aa],y);z.push(ba);}this.$TiledSphericalRenderer12[x]=z;}};o.__subClassMethods={__getFragmentShaderScript:true,__getVertexShaderScript:true,__getShaderPerspectiveMatrixUniformName:true,__getShaderRotationMatrixUniformName:true,__renderInternal:true,__shaderProgramReady:true,__getMaxGPUMemoryUsedBytes:true,__getPrevFrameTextureScreenRatio:true,__createTexture:true,__clearCache:true};f.exports=o;}),null);
__d('SphericalPhotoRenderer.redux',['cx','Promise','Bootloader','CubemapImageTileProvider','DOM','EntPhotoCubemapTileUriProvider','Event','ImageUtils','PhotoProjection','SphericalMediaCanvasPool','SphericalMediaRenderer.react','StaticCubemapTileUriProvider','TiledSphericalRenderer','joinClasses','performanceNow','uniqueID','getScaledPanoDimensions','ReactRedux','SphericalMediaCoreActions','SphericalMediaBaseActions','SphericalPhotoActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('ReactRedux').connect,l=c('SphericalMediaCoreActions').turnOff,m=c('SphericalMediaBaseActions').setupRenderer,n=c('SphericalMediaBaseActions').webGlInitFailed,o=c('SphericalMediaBaseActions').webGlRenderFailed,p=c('SphericalMediaBaseActions').webGlContextLost,q=c('SphericalMediaBaseActions').sourceOnLoad,r=c('SphericalPhotoActions').rendererStats,s=2;i=babelHelpers.inherits(t,c('SphericalMediaRenderer.react'));j=i&&i.prototype;function t(v){j.constructor.call(this,v);this.$SphericalPhotoRenderer11=function(){this.draw(this.__getViewData());}.bind(this);this.$SphericalPhotoRenderer2=c('DOM').create('img');this.$SphericalPhotoRenderer1=c('uniqueID')();this.$SphericalPhotoRenderer4=0;}t.prototype.__afterDraw=function(){};t.prototype.__beforeCanvasLost=function(){this.$SphericalPhotoRenderer5();this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;if(this.props.isActive)this.props.dispatch(l());};t.prototype.__getViewData=function(){var v=this.props.viewStore.getState(),w=v.view;return {fov:w.fov,pitch:w.pitch,yaw:w.yaw};};t.prototype.__getCanvas=function(){var v=this.$SphericalPhotoRenderer6();c('SphericalMediaCanvasPool').setLimit(s,v);var w={canvasAttrs:{width:this.props.width,height:this.props.height,className:c('joinClasses')(this.props.className,"_5nxw")},beforeCanvasLost:function(){return this.__beforeCanvasLost();}.bind(this)};return c('SphericalMediaCanvasPool').get(this.$SphericalPhotoRenderer1,w,v);};t.prototype.__onSetupDone=function(){this.$SphericalPhotoRenderer7();};t.prototype.__isReadyToSetup=function(){return this.props.isActive&&this.props.imageLoaded;};t.prototype.__onWebGlRenderFailed=function(v,w){this.props.dispatch(o(v,w));};t.prototype.__onWebGlContextLost=function(){this.props.dispatch(p());this.props.dispatch(l());};t.prototype.__onWebGlInitFailed=function(v){c('SphericalMediaCanvasPool').release(this.$SphericalPhotoRenderer1,this.props.canvasNamespace);this.props.dispatch(n(v));this.props.dispatch(l());};t.prototype.__getRenderer=function(v){return new (c('Promise'))(function(w,x){var y,z=this;if(this.props.tiledSphericalConfig.useTiledRenderer&&this.$SphericalPhotoRenderer3){w(new (c('TiledSphericalRenderer'))(v,this.$SphericalPhotoRenderer3,{partialLeftDegrees:this.props.partialLeftDegrees,partialRightDegrees:this.props.partialRightDegrees,partialTopDegrees:this.props.partialTopDegrees,partialBottomDegrees:this.props.partialBottomDegrees}));}else (function(){if(!z.props.imageLoaded)throw new Error('__getRenderer was called before the source has been loaded.');var aa=z.props,ba=aa.projectionType,ca=aa.photoSphereMetadata,da=c('getScaledPanoDimensions')(ca,z.$SphericalPhotoRenderer2.width);if(ba===c('PhotoProjection').EQUIRECTANGULAR){c('Bootloader').loadModules(["EquirectSphericalWebGLRenderer"],function(ea){w(new ea(this.$SphericalPhotoRenderer2,v,babelHelpers['extends']({poseHeadingDegrees:Number(ca.PoseHeadingDegrees)||0,posePitchDegrees:Number(ca.PosePitchDegrees)||0,poseRollDegrees:Number(ca.PoseRollDegrees)||0},da)));}.bind(z),'SphericalPhotoRenderer.redux');}else if(ba===c('PhotoProjection').CYLINDRICAL){c('Bootloader').loadModules(["CylindricalSphericalWebGLRenderer"],function(ea){w(new ea(this.$SphericalPhotoRenderer2,v,da));}.bind(z),'SphericalPhotoRenderer.redux');}else c('Bootloader').loadModules(["CubestripSphericalWebGLRenderer"],function(ea){w(new ea(this.$SphericalPhotoRenderer2,v));}.bind(z),'SphericalPhotoRenderer.redux');})();}.bind(this));};t.prototype.__destroy=function(){this.$SphericalPhotoRenderer5();j.__destroy.call(this);c('SphericalMediaCanvasPool').release(this.$SphericalPhotoRenderer1,this.$SphericalPhotoRenderer6());};t.prototype.$SphericalPhotoRenderer6=function(){var v=this.props.tiledSphericalConfig.useTiledRenderer?'tiled':'cubestrip';return v+this.props.canvasNamespace;};t.prototype.$SphericalPhotoRenderer5=function(){var v=this.sphericalRenderer;if(v){var w={avg_frame_render_time:v.getAverageFrameRenderTimeMillis(),avg_texture_to_screen_ratio2:v.getAverageTextureToScreenPixelRatio(),device_pixel_ratio:window.devicePixelRatio||1,dt:v.getTimeSinceFirstRenderMillis(),max_gpu_memory_used:v.getMaxGPUMemoryUsedBytes(),max_tile_level:this.$SphericalPhotoRenderer3?this.$SphericalPhotoRenderer3.getMaxTileLevel():null,render_method:this.props.tiledSphericalConfig.useTiledRenderer?'tiled':'cubestrip',total_data_loaded:this.$SphericalPhotoRenderer3?this.$SphericalPhotoRenderer3.getTotalPixelsLoaded():this.$SphericalPhotoRenderer8(),viewport_height:this.props.height,viewport_width:this.props.width};this.props.dispatch(r(w));}};t.prototype.$SphericalPhotoRenderer8=function(){if(this.$SphericalPhotoRenderer2&&c('ImageUtils').hasLoaded(this.$SphericalPhotoRenderer2)){var v=this.$SphericalPhotoRenderer2,w=v.width,x=v.height;return w*x;}return 0;};t.prototype.$SphericalPhotoRenderer9=function(v){var w,x=this,y=this.props.dispatch;c('DOM').setAttributes(this.$SphericalPhotoRenderer2,{crossOrigin:'anonymous',src:v});if(c('ImageUtils').hasLoaded(this.$SphericalPhotoRenderer2)){y(q());}else (function(){var z=c('Event').listen(x.$SphericalPhotoRenderer2,'load',function(){y(q());z.remove();});})();};t.prototype.$SphericalPhotoRenderer10=function(){var v=this.props,w=v.dispatch,x=v.tiledSphericalConfig;if(x.useTiledRenderer&&!this.$SphericalPhotoRenderer3){var y=this.props.fbid==='0'?new (c('StaticCubemapTileUriProvider'))(this.props.tiledSphericalConfig.initialTileUris):new (c('EntPhotoCubemapTileUriProvider'))(this.props.fbid,this.props.tiledSphericalConfig.initialTileUris),z=new (c('CubemapImageTileProvider'))(y,this.props.tiledSphericalConfig.maxTileLevel);z.addBaseLevelReadyCallback(function(){return w(q());});this.$SphericalPhotoRenderer3=z;}};t.prototype.$SphericalPhotoRenderer7=function(){this.draw(this.__getViewData());var v=this.sphericalRenderer;if(v){var w=c('performanceNow')()-this.$SphericalPhotoRenderer4;this.props.dispatch(m(v,w));}};t.prototype.componentDidMount=function(){var v=this.props.tiledSphericalConfig.useTiledRenderer;if(v){this.$SphericalPhotoRenderer10();}else if(this.props.cubeStripImageURI)this.$SphericalPhotoRenderer9(this.props.cubeStripImageURI);if(this.props.isActive)this.$SphericalPhotoRenderer4=c('performanceNow')();this.props.viewStore.subscribe(this.$SphericalPhotoRenderer11);j.componentDidMount.call(this);};t.prototype.componentWillReceiveProps=function(v){this.shouldRender=v.isActive&&!this.props.renderer||v.isActive!==this.props.isActive||v.thumbnail!==this.props.thumbnail||v.width!==this.props.width||v.height!==this.props.height;if(v.isActive&&v.isActive!==this.props.isActive)this.$SphericalPhotoRenderer4=c('performanceNow')();var w=this.props.tiledSphericalConfig.useTiledRenderer;if(w){this.$SphericalPhotoRenderer10();}else if(v.cubeStripImageURI&&!this.$SphericalPhotoRenderer2.src)this.$SphericalPhotoRenderer9(v.cubeStripImageURI);j.componentWillReceiveProps.call(this,v);};t.__subClassMethods={__afterDraw:true,__beforeCanvasLost:true,__getCanvas:true,__getRenderer:true,__getViewData:true,__onSetupDone:true,__isReadyToSetup:true,__onWebGlContextLost:true,__onWebGlInitFailed:true,__onWebGlRenderFailed:true};var u=function v(w){return {className:w.base.className,expansionCoef:w.base.expansionCoef,height:w.base.height,initialFov:w.base.initialFov,initialPitch:w.base.initialPitch,initialYaw:w.base.initialYaw,isActive:w.base.isRendererActive,projectionType:w.base.projectionType,renderer:w.base.renderer,tiledSphericalConfig:w.base.tiledSphericalConfig,width:w.base.width,partialLeftDegrees:w.base.partialLeftDegrees,partialRightDegrees:w.base.partialRightDegrees,partialTopDegrees:w.base.partialTopDegrees,partialBottomDegrees:w.base.partialBottomDegrees,fbid:w.base.fbid,isFetchingData:w.base.isFetchingData,imageLoaded:w.base.loaded,cubeStripImageURI:w.base.src,thumbnail:w.base.thumbnail,canvasNamespace:w.base.canvasNamespace,src:w.base.src,photoSphereMetadata:w.base.photoSphereMetadata,viewStore:w.base.viewStore};};f.exports=k(u)(t);}),null);
__d('SphericalPhotoStore',['SphericalMediaBaseStore','SphericalMediaBaseReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('SphericalMediaBaseStore'));i=h&&h.prototype;j.prototype.getReducers=function(){return {base:c('SphericalMediaBaseReducer')};};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('SphericalPhotoViewerLoggingMiddleware',['SphericalMediaActionNamespaces','SphericalMediaActions','SphericalPhotoViewerLoggerUtil'],(function a(b,c,d,e,f,g){'use strict';var h=function j(k,l,m){return {error_message:m?k.message+' | view: '+JSON.stringify(m):k.message,error_stack_trace:k.stack.split('at ')[1],render_method:l.base.tiledSphericalConfig.useTiledRenderer?'tiled':'cubestrip',viewport_height:l.base.height,viewport_width:l.base.width};},i=function j(k){var l=k.getState;return function(m){return function(n){var o=l(),p={dt:null,photoID:o.base.fbid,pitch:null,sessionID:o.base.sessionID,surface:o.base.surface,vfov:null,viewportHeight:null,viewportWidth:null,yaw:null};if(n.namespace===c('SphericalMediaActionNamespaces').BASE){switch(n.type){case c('SphericalMediaActions').DRAG_START:c('SphericalPhotoViewerLoggerUtil').logDragStart(p);break;case c('SphericalMediaActions').GYRO_START:c('SphericalPhotoViewerLoggerUtil').logWWWGyroStart(p);break;case c('SphericalMediaActions').ZOOM_START:c('SphericalPhotoViewerLoggerUtil').logZoomStart(p);break;case c('SphericalMediaActions').SIGNIFICANT_MOVE:p.yaw=n.data.view.yaw;p.pitch=n.data.view.pitch;p.vfov=n.data.view.fov;p.viewportHeight=o.base.height;p.viewportWidth=o.base.width;c('SphericalPhotoViewerLoggerUtil').logSignificantMovement(p);break;case c('SphericalMediaActions').MOUSE_ENTER:c('SphericalPhotoViewerLoggerUtil').logMouseOverStart(p);break;case c('SphericalMediaActions').MOUSE_ANIMATION_START:c('SphericalPhotoViewerLoggerUtil').logDragMouseAnimation(p);break;case c('SphericalMediaActions').SETUP_RENDERER:p.dt=n.data.dt;c('SphericalPhotoViewerLoggerUtil').logRendererSetup(p,o.base.tiledSphericalConfig.useTiledRenderer);break;case c('SphericalMediaActions').WEBGL_RENDER_FAILED:c('SphericalPhotoViewerLoggerUtil').logWebGlRenderFailed(p,h(n.data.error,o,n.data.view));break;case c('SphericalMediaActions').WEBGL_CONTEXT_LOST:c('SphericalPhotoViewerLoggerUtil').logWebGlContextLost(p);break;case c('SphericalMediaActions').WEBGL_INIT_FAILED:c('SphericalPhotoViewerLoggerUtil').logWebGlInitFailed(p,h(n.data.error,o));break;}}else if(n.type===c('SphericalMediaActions').PHOTO_RENDERER_STATS)c('SphericalPhotoViewerLoggerUtil').logRendererStats(p,n.data);return m(n);};};};f.exports=i;}),null);
__d('SphericalPhotoViewer.react',['cx','BootloadedComponent.react','JSResource','React','SphericalMediaController.react','SphericalPhotoViewerLoggingMiddleware','SphericalPhotoRenderer.redux','SphericalPhotoStore','ReactRedux','SphericalMediaCoreActions','SphericalMediaBaseActions','SphericalMediaViewActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('ReactRedux').Provider,l=c('SphericalMediaCoreActions').turnOn,m=c('SphericalMediaCoreActions').turnOff,n=c('SphericalMediaBaseActions').updateBase,o=c('SphericalMediaBaseActions').updateDimension,p=c('SphericalMediaViewActions').updateView;i=babelHelpers.inherits(q,c('React').PureComponent);j=i&&i.prototype;function q(r){j.constructor.call(this,r);this.__store=new (c('SphericalPhotoStore'))(this.__getMiddleware()).getStore();}q.prototype.componentWillUnmount=function(){this.__store.dispatch(m());};q.prototype.componentWillMount=function(){this.__updateState();this.__store.dispatch(l());};q.prototype.componentDidUpdate=function(){this.__updateState();};q.prototype.__getMiddleware=function(){var r=this.props.middlewares||[];return r.concat([c('SphericalPhotoViewerLoggingMiddleware')]);};q.prototype.__updateState=function(){var r={enableGyro:this.props.enableGyro,enableZoom:this.props.enableZoom,enableRubberBanding:this.props.enableRubberBanding,visibility:true};if(this.props.partialLimits)r=babelHelpers['extends']({},r,this.props.partialLimits);this.__store.dispatch(n(babelHelpers['extends']({initialYaw:this.props.initialView.yaw,initialPitch:this.props.initialView.pitch,initialFov:this.props.initialView.fov,tiledSphericalConfig:this.props.tiledSphericalConfig,caption:this.props.caption,canvasNamespace:this.props.canvasNamespace,fbid:this.props.photoID,src:this.props.cubeImageURI,surface:this.props.surface,thumbnail:this.props.initialImageURI||''},r)));this.__store.dispatch(o(this.props.width,this.props.height));var s=this.__store.getState().base.viewStore;s.dispatch(p({yaw:this.props.initialView.yaw,pitch:this.props.initialView.pitch,fov:this.props.initialView.fov}));};q.prototype.render=function(){return (c('React').createElement(k,{store:this.__store},c('React').createElement('div',{className:"_3o6m _5nxw"},c('React').createElement(c('SphericalPhotoRenderer.redux'),null),c('React').createElement(c('SphericalMediaController.react'),null),c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalPhotoHeadingIndicator.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}),this.props.showMouseAnimation?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalMediaMouseOverlay.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null,this.props.showGyroAnimation?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalMediaGyroOverlay.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null)));};q.defaultProps={canvasNamespace:'PhotoViewer',enableGyro:false,enableRubberBanding:false,enablevisibilityObserver:false,enableZoom:false,showGyroAnimation:false,showMouseAnimation:true};f.exports=q;}),null);
__d('SphericalPhotoViewerInFeed.react',['cx','Arbiter','Bootloader','CSS','Event','ReactDOM','SphericalMediaActions','SphericalPhotoViewer.react','SubscriptionsHandler','getElementRect','onViewportChanged','debounce','SphericalMediaCoreActions','SphericalMediaBaseActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('SphericalMediaCoreActions').turnOn,l=c('SphericalMediaCoreActions').turnOff,m=c('SphericalMediaBaseActions').visibilityChanged,n=5000,o=50;i=babelHelpers.inherits(p,c('SphericalPhotoViewer.react'));j=i&&i.prototype;function p(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=j.constructor).call.apply(q,[this].concat(t)),this.$SphericalPhotoViewerInFeed6=false,this.$SphericalPhotoViewerInFeed13=function(){if(this.$SphericalPhotoViewerInFeed14())return;if(this.$SphericalPhotoViewerInFeed8&&this.$SphericalPhotoViewerInFeed8.isOpen)return;this.__store.dispatch(k());}.bind(this),this.$SphericalPhotoViewerInFeed12=c('debounce')(function(v){if(!this.$SphericalPhotoViewerInFeed5)return;var w=c('getElementRect')(this.$SphericalPhotoViewerInFeed5),x=v.bottom-v.top,y=w.bottom-w.top,z=(x-y)/3,aa=v.top+z,ba=v.bottom-z,ca=w.top>aa&&w.top<ba||w.bottom>aa&&w.bottom<ba||aa>w.top&&ba<w.bottom;if(this.$SphericalPhotoViewerInFeed3!==ca){this.$SphericalPhotoViewerInFeed3=ca;ca?this.$SphericalPhotoViewerInFeed15():this.$SphericalPhotoViewerInFeed16();}}.bind(this),o),r;}p.prototype.__getMiddleware=function(){var q=j.__getMiddleware.call(this),r=function(){return function(u){return function(v){if(v.type===c('SphericalMediaActions').VIEWPORT_CLICKED)c('Bootloader').loadModules(["PhotoSnowlift"],function(w){w.bootstrap(this.props.permalinkURI);this.$SphericalPhotoViewerInFeed8=w.getInstance();}.bind(this),'SphericalPhotoViewerInFeed.react');return u(v);}.bind(this);}.bind(this);}.bind(this),s=function(){return function(u){return function(v){if(v.type===c('SphericalMediaActions').TURN_ON)this.$SphericalPhotoViewerInFeed9();if(v.type===c('SphericalMediaActions').SETUP_RENDERER)this.$SphericalPhotoViewerInFeed10();return u(v);}.bind(this);}.bind(this);}.bind(this),t=function(){return function(u){return function(v){if(v.type===c('SphericalMediaActions').TURN_OFF){this.$SphericalPhotoViewerInFeed3=false;c('CSS').show(this.props.loadingElement);this.$SphericalPhotoViewerInFeed11();}return u(v);}.bind(this);}.bind(this);}.bind(this);return q.concat([r,s,t]);};p.prototype.componentDidMount=function(){this.__updateState();this.$SphericalPhotoViewerInFeed11();var q=c('onViewportChanged')(this.$SphericalPhotoViewerInFeed12);this.$SphericalPhotoViewerInFeed1=c('Arbiter').subscribe('PhotoSnowlift.CLOSE',function(){this.$SphericalPhotoViewerInFeed3=false;q.scheduleCheck();}.bind(this));this.$SphericalPhotoViewerInFeed2=c('Arbiter').subscribe('PhotoSnowlift.OPEN',function(){c('Bootloader').loadModules(["PhotoSnowlift"],function(t){this.$SphericalPhotoViewerInFeed8=t.getInstance();}.bind(this),'SphericalPhotoViewerInFeed.react');}.bind(this));this.$SphericalPhotoViewerInFeed3=false;var r=new (c('SubscriptionsHandler'))(),s=c('ReactDOM').findDOMNode(this);r.addSubscriptions(c('Event').listen(s,'mouseenter',this.$SphericalPhotoViewerInFeed13),c('Event').listen(s,'touchstart',this.$SphericalPhotoViewerInFeed13));q.scheduleCheck();this.$SphericalPhotoViewerInFeed4=q;this.$SphericalPhotoViewerInFeed7=r;this.$SphericalPhotoViewerInFeed5=s;};p.prototype.componentWillMount=function(){this.__updateState();};p.prototype.componentWillUnmount=function(){if(this.$SphericalPhotoViewerInFeed1){c('Arbiter').unsubscribe(this.$SphericalPhotoViewerInFeed1);this.$SphericalPhotoViewerInFeed1=null;}if(this.$SphericalPhotoViewerInFeed2){c('Arbiter').unsubscribe(this.$SphericalPhotoViewerInFeed2);this.$SphericalPhotoViewerInFeed2=null;}this.$SphericalPhotoViewerInFeed4&&this.$SphericalPhotoViewerInFeed4.remove();this.$SphericalPhotoViewerInFeed4=null;this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.release();this.$SphericalPhotoViewerInFeed7=null;this.$SphericalPhotoViewerInFeed5=null;j.componentWillUnmount.call(this);};p.prototype.$SphericalPhotoViewerInFeed9=function(){c('CSS').addClass(this.props.loadingElement,"_2dz7");c('CSS').removeClass(this.props.loadingElement,"_3s0i");};p.prototype.$SphericalPhotoViewerInFeed11=function(){c('CSS').removeClass(this.props.loadingElement,"_2dz7");c('CSS').addClass(this.props.loadingElement,"_3s0i");};p.prototype.$SphericalPhotoViewerInFeed10=function(){c('CSS').removeClass(this.props.loadingElement,"_2dz7");setTimeout(function(){return c('CSS').hide(this.props.loadingElement);}.bind(this),300);};p.prototype.$SphericalPhotoViewerInFeed14=function(){return this.__store.getState().base.isRendererActive;};p.prototype.$SphericalPhotoViewerInFeed16=function(){this.$SphericalPhotoViewerInFeed11();setTimeout(function(){if(!this.$SphericalPhotoViewerInFeed3&&this.$SphericalPhotoViewerInFeed14())this.__store.dispatch(l());}.bind(this),n);this.__store.dispatch(m(false));};p.prototype.$SphericalPhotoViewerInFeed15=function(){this.$SphericalPhotoViewerInFeed13();this.__store.dispatch(m(true));};f.exports=p;}),null);